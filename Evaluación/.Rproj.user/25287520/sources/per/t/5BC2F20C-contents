library(tidyverse)
library(laeken)
library(readxl)
library(openxlsx)
library(hms)

ENUT<- read.delim(file = "enut2021_base/enut2021_base.txt", header = T, sep='|', dec=".")

ENUT_may <- ENUT %>% 
  filter(EDAD_SEL >= 60) %>%
  select(ID, WPER, EDAD_SEL, SEXO_SEL, GRUPO_EDAD_SEL, REGION, TP_ACT_CUIDADODELASALUD, TP_ACT_TRASLADOSALUD, 
         TCS_ACT_CUIDARLASALUD, TSS_ACT_CUIDARLASALUD, TCS_ACT_TRASLADOSALUD, TSS_ACT_TRASLADOSALUD,
         BHCH14_01_SEL, #obra social
         BHCH14_02_SEL,
         TP_ACT_DEPORTE, TCS_ACT_DEPORTE, TSS_ACT_DEPORTE) %>% #pami  
  mutate(SEXO                = case_when(SEXO_SEL == 1 ~ "Mujer",
                                         SEXO_SEL == 2 ~ "Varon"),
         GRUPO_EDAD_MAY     = case_when(EDAD_SEL %in% c(60:74)  ~ "3ERA EDAD",
                                        EDAD_SEL >= 75  ~ "4TA EDAD"),
         TP_cuidadosalud    = case_when(TP_ACT_CUIDADODELASALUD == 1 ~ 1,
                                        TP_ACT_TRASLADOSALUD   == 1 ~ 1,
                                        .default = FALSE),
         HS_cuidadosalud    = case_when(TP_cuidadosalud == 1~(TCS_ACT_CUIDARLASALUD + TCS_ACT_TRASLADOSALUD),
                                        .default = FALSE))
         



ENUT_may2 <- ENUT_may %>%
  group_by(GRUPO_EDAD_MAY, SEXO) %>% 
  summarise(Poblacion          = sum(WPER),
            cuidadosalud       = sum(WPER[TP_cuidadosalud==1]),
            tp_cuidadosalud    = round(cuidadosalud/Poblacion*100, digits=1),
            hs_cuidadosalud    = round(weighted.mean(HS_cuidadosalud[HS_cuidadosalud >= 1], WPER[HS_cuidadosalud >= 1]), digits=1),
            "Horas cuidado de la salud"   = hms(minutes = hs_cuidadosalud))


ENUT_deporte <- ENUT_may %>%
  group_by(SEXO) %>%
  summarise(Poblacion          = sum(WPER),
            deporte            = sum(WPER[TP_ACT_DEPORTE==1]),
            tp_deporte         = round(deporte/Poblacion*100, digits=1),
            hs_deporte         = round(weighted.mean(TCS_ACT_DEPORTE[TCS_ACT_DEPORTE >= 1], WPER[TCS_ACT_DEPORTE >= 1]), digits=1),
            "Horas deporte"    = hms(minutes = hs_deporte))






